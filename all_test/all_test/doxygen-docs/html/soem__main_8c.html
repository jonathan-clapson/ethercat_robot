<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>SOEM+TwinCAT3: Untitled1/soem_main.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SOEM+TwinCAT3
   </div>
   <div id="projectbrief">SOEM based implementation (make) and TwinCAT3 based implementation (visual studio 2010) for Ethercat Delta Robot</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_28f4d3f836ca721e4baef05771523f02.html">Untitled1</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">soem_main.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Main program for the University of Auckland delta robot in Industrial Informatics.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;sched.h&gt;</code><br/>
<code>#include &lt;pthread.h&gt;</code><br/>
<code>#include &lt;sys/time.h&gt;</code><br/>
<code>#include &lt;signal.h&gt;</code><br/>
<code>#include &quot;ethercattype.h&quot;</code><br/>
<code>#include &quot;nicdrv.h&quot;</code><br/>
<code>#include &quot;ethercatbase.h&quot;</code><br/>
<code>#include &quot;ethercatmain.h&quot;</code><br/>
<code>#include &quot;ethercatconfig.h&quot;</code><br/>
<code>#include &quot;ethercatcoe.h&quot;</code><br/>
<code>#include &quot;ethercatdc.h&quot;</code><br/>
<code>#include &quot;ethercatprint.h&quot;</code><br/>
<code>#include &quot;ethercatsoe.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="wago__steppers_8h_source.html">wago_steppers.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="state__machine_8h_source.html">state_machine.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="error_8h_source.html">error.h</a>&quot;</code><br/>
</div>
<p><a href="soem__main_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structinput__msg__t.html">input_msg_t</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a0501e82515b2bdf36453c4cc80f5e0cc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#a0501e82515b2bdf36453c4cc80f5e0cc">NSEC_PER_SEC</a>&#160;&#160;&#160;1000000000</td></tr>
<tr class="memitem:af4021b95b18dc511ba274a310fe66d08"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#af4021b95b18dc511ba274a310fe66d08">TICK_RATE</a>&#160;&#160;&#160;100000</td></tr>
<tr class="memitem:ab98c08609c7126210073e90b94f8eca4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#ab98c08609c7126210073e90b94f8eca4">EtherCAT_TIMEOUT</a>&#160;&#160;&#160;EC_TIMEOUTRET</td></tr>
<tr class="memitem:ad3855860424daea7592ec3951d126149"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#ad3855860424daea7592ec3951d126149">TIMESPEC_LESS</a>&#160;&#160;&#160;-1</td></tr>
<tr class="memitem:a3c1b14618b80a3df1748551f94a7adfd"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#a3c1b14618b80a3df1748551f94a7adfd">TIMESPEC_GREATER</a>&#160;&#160;&#160;1</td></tr>
<tr class="memitem:ab2777445acd8b159aedd5347a5828995"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#ab2777445acd8b159aedd5347a5828995">TIMESPEC_EQUAL</a>&#160;&#160;&#160;0</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af9b9c7dcc665829b18a147bd853a5a99"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#af9b9c7dcc665829b18a147bd853a5a99">check_input</a> (void *ptr)</td></tr>
<tr class="memitem:a9c718ba27f7c940fd3cfeba8e03f6693"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#a9c718ba27f7c940fd3cfeba8e03f6693">read_soe_info</a> (int slave, int drive_no)</td></tr>
<tr class="memitem:a2442dcc90f6813ed8a3815bc9051a1a7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#a2442dcc90f6813ed8a3815bc9051a1a7">read_soe_info_simp</a> (int slave, int drive_no)</td></tr>
<tr class="memitem:a6d662e95ebe6820b9ab1309885b12721"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#a6d662e95ebe6820b9ab1309885b12721">read_soe_info2</a> (int slave, int drive_no)</td></tr>
<tr class="memitem:ab333aa69248425a6a2a2b868ea188f41"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#ab333aa69248425a6a2a2b868ea188f41">add_timespec</a> (struct timespec *ts, int64 addtime)</td></tr>
<tr class="memitem:a54b1d88154742acb0943ca98324c29d3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#a54b1d88154742acb0943ca98324c29d3">compare_timespec</a> (struct timespec ts1, struct timespec ts2)</td></tr>
<tr class="memitem:ac4f7c09ab2b789c2d88025d1149da8eb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#ac4f7c09ab2b789c2d88025d1149da8eb">subtract_timespec</a> (struct timespec ts1, struct timespec ts2, struct timespec *result)</td></tr>
<tr class="memitem:a2236b3aa05099f148da8f6a0c6b967c7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#a2236b3aa05099f148da8f6a0c6b967c7">ec_sync</a> (int64 reftime, int64 cycletime, int64 *offsettime)</td></tr>
<tr class="memitem:a23fd1dbf9b966ae13f7a095002cc2978"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#a23fd1dbf9b966ae13f7a095002cc2978">ethercat_init_device</a> (char *ifname)</td></tr>
<tr class="memitem:a9b8a2ba82b20121e312c5fefb459170d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#a9b8a2ba82b20121e312c5fefb459170d">ethercat_init_to_pre_op</a> ()</td></tr>
<tr class="memitem:a1bc1ea69b43e10a4338661912eb267a7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#a1bc1ea69b43e10a4338661912eb267a7">ethercat_pre_op_to_safe_op</a> ()</td></tr>
<tr class="memitem:a486a723e4eb373a1ddae90c944b92a6d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#a486a723e4eb373a1ddae90c944b92a6d">ethercat_safe_op_to_pre_op</a> ()</td></tr>
<tr class="memitem:a014765da2374758a95ab6b25b22996a7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#a014765da2374758a95ab6b25b22996a7">ethercat_safe_op_to_op</a> ()</td></tr>
<tr class="memitem:a0c57c076ed56a631d139912df20c7f1e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#a0c57c076ed56a631d139912df20c7f1e">ethercat_op_to_safe_op</a> ()</td></tr>
<tr class="memitem:adefe85b5f595f285fa266a70d75f0a77"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#adefe85b5f595f285fa266a70d75f0a77">ethercat_thread</a> (void *ptr)</td></tr>
<tr class="memitem:a0bed8474bd33a912769360766f6b10d4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#a0bed8474bd33a912769360766f6b10d4">help</a> (void)</td></tr>
<tr class="memitem:ada013d80f43e3422f7aadace8eb3b93a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#ada013d80f43e3422f7aadace8eb3b93a">process_cmd_opts</a> (int argc, char *argv[])</td></tr>
<tr class="memitem:a0ddf1224851353fc92bfbff6f499fa97"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:abd49ea7d1a34c36e74ff633f727a6260"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#abd49ea7d1a34c36e74ff633f727a6260">IOmap</a> [4096]</td></tr>
<tr class="memitem:a37eb1529e7feec14c3bc89743ecbaf7b"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#a37eb1529e7feec14c3bc89743ecbaf7b">eth_dev</a> = &quot;eth0&quot;</td></tr>
<tr class="memitem:af53de72f092c879d6cba139b2460f4f6"><td class="memItemLeft" align="right" valign="top">uint32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#af53de72f092c879d6cba139b2460f4f6">cycle_time</a> = 1000</td></tr>
<tr class="memitem:aa1ad002690c58b802284dc9a573897db"><td class="memItemLeft" align="right" valign="top">uint32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#aa1ad002690c58b802284dc9a573897db">move_coord</a> = 0</td></tr>
<tr class="memitem:aafa0738e1894994d26afec89aa385fa2"><td class="memItemLeft" align="right" valign="top">const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#aafa0738e1894994d26afec89aa385fa2">WAGO_DEVICE_OFFSETS_MOSI</a> [] = {0x0005, 0x0011, 0x001d}</td></tr>
<tr class="memitem:a5d7a591e40976c3c39f6750a24215603"><td class="memItemLeft" align="right" valign="top">const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#a5d7a591e40976c3c39f6750a24215603">WAGO_DEVICE_OFFSETS_MISO</a> [] = {0x0030, 0x003c, 0x0048}</td></tr>
<tr class="memitem:a270922032f11bc8e88c14b19a4dc283e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="soem__main_8c.html#a270922032f11bc8e88c14b19a4dc283e">cycle_count</a> = 0</td></tr>
</table>
<a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Main program for the University of Auckland delta robot in Industrial Informatics. </p>
<p>This program is used to connect to and control a delta robot </p>

<p>Definition in file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>
</div><h2>Macro Definition Documentation</h2>
<a class="anchor" id="ab98c08609c7126210073e90b94f8eca4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EtherCAT_TIMEOUT&#160;&#160;&#160;EC_TIMEOUTRET</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00033">33</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0501e82515b2bdf36453c4cc80f5e0cc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NSEC_PER_SEC&#160;&#160;&#160;1000000000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00031">31</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="af4021b95b18dc511ba274a310fe66d08"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TICK_RATE&#160;&#160;&#160;100000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00032">32</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab2777445acd8b159aedd5347a5828995"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TIMESPEC_EQUAL&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00169">169</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3c1b14618b80a3df1748551f94a7adfd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TIMESPEC_GREATER&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00168">168</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad3855860424daea7592ec3951d126149"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TIMESPEC_LESS&#160;&#160;&#160;-1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00167">167</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<h2>Function Documentation</h2>
<a class="anchor" id="ab333aa69248425a6a2a2b868ea188f41"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void add_timespec </td>
          <td>(</td>
          <td class="paramtype">struct timespec *&#160;</td>
          <td class="paramname"><em>ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64&#160;</td>
          <td class="paramname"><em>addtime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>adds an amount of nanoseconds to a timespec</p>
<p>Adds addtime (units nanoseconds) to timespec </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ts</td><td>timespec to add nanoseconds to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">addtime</td><td>number of nanoseconds to add </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00157">157</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="af9b9c7dcc665829b18a147bd853a5a99"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void check_input </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Input handling function, run by input handling thread</p>
<p>This function handles commandline input. It could be used at a later time to facilitate control of the EtherCAT devices using the keyboard. Right now it is only used to signal to the main program that we would like to quit. </p>
<dl class="section warning"><dt>Warning</dt><dd>don't modify this function so that it updates the iomap. If you want to do keyboard control, the far better way to implement it is to send events, glibc may be helpful for this. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ptr</td><td>A pointer to the <a class="el" href="structinput__msg__t.html">input_msg_t</a> used to signal exit to the other threads </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00050">50</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a54b1d88154742acb0943ca98324c29d3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int compare_timespec </td>
          <td>(</td>
          <td class="paramtype">struct timespec&#160;</td>
          <td class="paramname"><em>ts1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct timespec&#160;</td>
          <td class="paramname"><em>ts2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compares timespecs for greater than, less than and equality</p>
<p>This function takes two timespecs and compares returning greather than, less than, or equality </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ts1</td><td>First timespec </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ts2</td><td>Second timespec </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns TIMESPEC_LESS when ts1 is less than ts2 TIMESPEC_GREATER when ts1 is greater than ts2 TIMESPEC_EQUAL when ts1 is equal to ts2 </dd></dl>

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00180">180</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2236b3aa05099f148da8f6a0c6b967c7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ec_sync </td>
          <td>(</td>
          <td class="paramtype">int64&#160;</td>
          <td class="paramname"><em>reftime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64&#160;</td>
          <td class="paramname"><em>cycletime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64 *&#160;</td>
          <td class="paramname"><em>offsettime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>PI calculation to get linux time synced to Distributed Clock time</p>
<p>This was taken from the SOEM ebox example. I'm not entirely sure what it does. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">reftime</td><td>some sort of reference time? </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cycletime</td><td>the period of a cycle, probably in nanoseconds </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">offsettime</td><td>maybe an amount of time to add or remove from next cycle? </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00227">227</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a23fd1dbf9b966ae13f7a095002cc2978"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ethercat_init_device </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>ifname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialises the Ethernet connectioon to use for EtherCAT communications</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ifname</td><td>The interface name to use, ie. eth0 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ERR_SUCCESS on success, ERR_ETH_DEV_FAIL on failure. </dd></dl>

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00245">245</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9b8a2ba82b20121e312c5fefb459170d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ethercat_init_to_pre_op </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Bring slaves from init to pre-op</p>
<p>Configure EtherCAT modules and brings them to pre-op. </p>
<dl class="section return"><dt>Returns</dt><dd>Returns ERR_SUCCESS on success, ERR_CONFIG_FAIL if mailboxes could not be configured, ERR_FAILED_PRE_OP if all slaves could not be brought to pre-op state </dd></dl>

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00260">260</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0c57c076ed56a631d139912df20c7f1e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ethercat_op_to_safe_op </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Brings slave back to safe-op</p>
<dl class="section return"><dt>Returns</dt><dd>ERR_SUCCESS. This function needs to be updated to detect problems </dd></dl>

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00368">368</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1bc1ea69b43e10a4338661912eb267a7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ethercat_pre_op_to_safe_op </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Bring slaves into safe-op</p>
<p>Give SOEM access to the I/O map and bring devices into safe-op </p>
<dl class="section return"><dt>Returns</dt><dd>ERR_SUCCESS on success, ERR_EC_NO_SLAVES on failure to map slaves into io map (this error name should probably change...), ERR_FAILED_SAFE_OP if all slaves could not be brought into safe-op state. </dd></dl>

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00291">291</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a014765da2374758a95ab6b25b22996a7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ethercat_safe_op_to_op </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Bring slaves into operational state</p>
<dl class="section return"><dt>Returns</dt><dd>Returns ERR_SUCCESS on success, ERR_FAILED_OP on failure to bring all slaves into operational state </dd></dl>

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00344">344</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a486a723e4eb373a1ddae90c944b92a6d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ethercat_safe_op_to_pre_op </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Bring slaves back to pre-op</p>
<dl class="section return"><dt>Returns</dt><dd>Returns ERR_SUCCESS this needs to be updated to check it worked and return an error if it didnt. </dd></dl>

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00331">331</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="adefe85b5f595f285fa266a70d75f0a77"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ethercat_thread </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Ethercat update thread</p>
<p>Handles the Initialisation and (should handle) maintainance of EtherCAT network. Updates the I/O map at specific timing intervals. This needs to happen at specific intervals or the slaves will enter error states. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ptr</td><td>a reference to the structure which keeps track of whether the program should exit (type is <a class="el" href="structinput__msg__t.html">input_msg_t</a>). </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00408">408</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0bed8474bd33a912769360766f6b10d4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void help </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Displays help message on commandline </p>

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00488">488</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0ddf1224851353fc92bfbff6f499fa97"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>main function</p>
<p>Sets up threads cyclically calls state machine to update state and I/O's </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">argc</td><td>commandline argument count </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">argv</td><td>commandline arguments </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns 0 </dd></dl>

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00537">537</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="ada013d80f43e3422f7aadace8eb3b93a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void process_cmd_opts </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Processes commandline arguments</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">argc</td><td>commandline argument count </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">argv</td><td>commandline arguments </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00502">502</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9c718ba27f7c940fd3cfeba8e03f6693"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void read_soe_info </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>slave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>drive_no</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function for testing writing of an SoE parameter.</p>
<p>This function tests writing an SoE parameter. It does not work correctly. Need to examine wireshark logs of TwinCAT3 software and this to check whats different. Only need to test with TwinCATs inbuilt motor testing rather than actual code. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">slave</td><td>The slave number to write to. (currently not used) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">drive_no</td><td>Which drive on the slave we're writing to. (currently not used) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00082">82</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6d662e95ebe6820b9ab1309885b12721"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void read_soe_info2 </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>slave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>drive_no</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function for testing reading of an SoE parameter.</p>
<p>This function tests reading an SoE parameter. It does not work correctly. Need to examine wireshark logs of TwinCAT3 software and this to check whats different. Only need to test with TwinCATs inbuilt motor testing rather than actual code. This is an idea for how to deal with setting up and verifying startup parameters. (use two arrays, one to hold parameter number, one to hold data, then can just loop through), an array of struct is probably better, struct holding both param and value. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">slave</td><td>The slave number to write to. (currently not used) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">drive_no</td><td>Which drive on the slave we're writing to. (currently not used) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00129">129</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2442dcc90f6813ed8a3815bc9051a1a7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void read_soe_info_simp </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>slave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>drive_no</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function for testing reading of an SoE parameter.</p>
<p>This function tests reading an SoE parameter. It does not work correctly. Need to examine wireshark logs of TwinCAT3 software and this to check whats different. Only need to test with TwinCATs inbuilt motor testing rather than actual code. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">slave</td><td>The slave number to write to. (currently not used) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">drive_no</td><td>Which drive on the slave we're writing to. (currently not used) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00108">108</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac4f7c09ab2b789c2d88025d1149da8eb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int subtract_timespec </td>
          <td>(</td>
          <td class="paramtype">struct timespec&#160;</td>
          <td class="paramname"><em>ts1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct timespec&#160;</td>
          <td class="paramname"><em>ts2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct timespec *&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Subtracts two timespec</p>
<p>Subtract ts2 from ts1 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ts1</td><td>First timespec </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ts2</td><td>Second timespec </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">result</td><td>difference in time as a timespec </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns 0 </dd></dl>

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00202">202</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<h2>Variable Documentation</h2>
<a class="anchor" id="a270922032f11bc8e88c14b19a4dc283e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> cycle_count = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00071">71</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="af53de72f092c879d6cba139b2460f4f6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32 cycle_time = 1000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00064">64</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a37eb1529e7feec14c3bc89743ecbaf7b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* eth_dev = &quot;eth0&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00063">63</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="abd49ea7d1a34c36e74ff633f727a6260"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char IOmap[4096]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00060">60</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa1ad002690c58b802284dc9a573897db"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32 move_coord = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00065">65</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5d7a591e40976c3c39f6750a24215603"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const int WAGO_DEVICE_OFFSETS_MISO[] = {0x0030, 0x003c, 0x0048}</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00069">69</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="aafa0738e1894994d26afec89aa385fa2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const int WAGO_DEVICE_OFFSETS_MOSI[] = {0x0005, 0x0011, 0x001d}</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="soem__main_8c_source.html#l00068">68</a> of file <a class="el" href="soem__main_8c_source.html">soem_main.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Feb 12 2014 11:08:09 for SOEM+TwinCAT3 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
